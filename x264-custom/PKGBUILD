# Maintainer: nyfair <nyfair2012@gmail.com>

pkgname=x264-custom
pkgver=2638
pkgrel=1
pkgdesc="Library for encoding H264/AVC video streams"
arch=('x86_64')
url="http://www.videolan.org/developers/x264.html"
license=('GPL')
depends=('ffmpeg')
makedepends=('yasm')
source=("https://github.com/msg7086/x264_tMod/archive/Yuuki.zip"
        sample.mkv)
md5sums=('SKIP' 'SKIP')

package() {
  HOST=x86_64-w64-mingw32
  export CFLAGS="-march=core2 -Ofast -pipe"
  cd ${srcdir}/x264*
  cp ${srcdir}/sample.mkv ./
  mkdir -p ${pkgdir}/usr/bin

  ./configure --enable-static --host=$HOST --disable-interlaced
  sed -i "s/0+.*\[/$pkgver \[/" x264_config.h
  make fprofiled VIDS=sample.mkv
  install -m755 x264.exe ${pkgdir}/usr/bin/

  ./configure --enable-static --host=$HOST --disable-interlaced --bit-depth=10
  sed -i "s/0+.*\[/$pkgver \[/" x264_config.h
  make fprofiled VIDS=sample.mkv
  install -m755 x264.exe ${pkgdir}/usr/bin/x264-10.exe
}
